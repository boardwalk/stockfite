<!DOCTYPE html>
<html>
  <head>
    <title>STOCKFITE!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
  </head>
  <body>
    <canvas id="chart"></canvas>
    <script>
      var ntdoy_p = $ntdoy_p;
      var ntdoy_d = $ntdoy_d;
      var fds_p = $fds_p;
      var fds_d = $fds_d;

      function formatMoney(x) {
        return x.toLocaleString(x, {"style": "currency", "currency": "usd"});
      }

      function makePriceData(p, d) {
          var data = [];
          var shares = 1000 / p[0].Open;

          var di = 0;
          for(var pi = 0; pi < p.length; pi++) {
            while(di < d.length && d[di].Date <= p[pi].Date) {
              dividend = shares * d[di].Dividends;
              shares += dividend / p[pi].Close;
              di++;
            }

            data.push({
              x: p[pi].Date,
              y: shares * p[pi].Close,
              open: p[pi].Open,
              close: p[pi].Close,
              shares: shares
            });
          }

          return data;
      }

      var chart = new Chart("chart",
        {
          type: 'line',
          data: {
            datasets: [
              {
                label: 'NTDOY',
                data: makePriceData(ntdoy_p, ntdoy_d),
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                borderColor: "rgba(255, 99, 132, 1)"
              },
              {
                label: 'FDS',
                data: makePriceData(fds_p, fds_d),
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)"
              }
            ]
          },
          options: {
            scales: {
              yAxes: [
                {
                  ticks: {
                    callback: function(value, index, values) {
                      return formatMoney(value);
                    }
                  }
                }
              ],
              xAxes: [
                {
                  type: "time",
                  time: {
                    unit: "day",
                    displayFormats: {"day": "M/DD"}
                  }
                }
              ]
            },
            title: {display: true, text: "Growth of $$1,000"},
            legend: {position: "bottom"},
            tooltips: {
              callbacks: {
                label: function(tooltipItem, data) {
                  var obj = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                  return formatMoney(tooltipItem.yLabel) +
                    " (open " + formatMoney(parseFloat(obj.open)) +
                    ", close " + formatMoney(parseFloat(obj.close)) +
                    ", shares " + parseFloat(obj.shares).toFixed(2) + ")";
                }
              }
            }
          }
        });
    </script>
  </body>
</html>

